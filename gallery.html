<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>ギャラリー</title>
<link rel="stylesheet" href="test.css" type="text/css">
<style>
body{
  background:#000;
  color:#fff;
  margin:0;
}

/* 画像だけのグリッド */
.grid{
  display:flex;
  flex-wrap:wrap;
  justify-content: center;
  gap:10px;
  padding:20px;

  width:100%;
  box-sizing:border-box;
}

.item{
  width:220px;
}

.item img{
  width:100%;
  display:block;
}

/* もどるボタン */
.back{
  position:fixed;
  bottom:20px;
  left:20px;
  font-family: YuMincho, "Yu Mincho", serif;
  font-size:16px;
}

.back a{
  color:white;
  text-decoration:none;
}
</style>

</head>

<body>

<div class="grid" id="list"></div>

<div class="back">
  <a href="javascript:history.back()">◀ BACK</a>
</div>

<script>
function openDB(callback) {
  const request = indexedDB.open("FrillGalleryDB", 1);

  request.onupgradeneeded = e => {
    const db = e.target.result;
    if (!db.objectStoreNames.contains("images")) {
      db.createObjectStore("images", { autoIncrement: true });
    }
  };

  request.onsuccess = e => {
    callback(e.target.result);
  };
}

function loadGallery(){
  const list = document.getElementById("list");

  openDB(db => {
    const tx = db.transaction("images", "readonly");
    const store = tx.objectStore("images");

    store.openCursor(null, "prev").onsuccess = e => {
      const cursor = e.target.result;
      if(cursor){
        const div = document.createElement("div");
        div.className = "item";

        const img = document.createElement("img");
        img.src = cursor.value.img;

        div.appendChild(img);
        list.appendChild(div);

        cursor.continue();
      }
    };
  });
}

// ★ これが無いと何も起きません
loadGallery();
</script>

</body>
</html>

